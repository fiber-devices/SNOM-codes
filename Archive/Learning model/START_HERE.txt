â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸ¯ YOUR EXACT SOLUTION - START HERE                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

YOUR SITUATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ You have: t, mi = load_data("../data/m400_.npy", 2, 0, 50)
âœ“ Triangle wave scans with 0.5 s round trip
âœ“ Want: 80 samples (40 forward + 40 backward) 
âœ“ Goal: Build nonlinear phase model & fit signals to minimize residuals

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        ğŸ“ FILES TO USE (IN ORDER)                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  READ THIS FIRST:
    â””â”€ TRIANGLE_WAVE_GUIDE.md .................. Complete guide for your case
       (5 min read, covers everything)

2ï¸âƒ£  YOUR CODE:
    â””â”€ your_workflow.py ........................ Ready-to-run template â­
       (Edit load_data() function, then run!)

3ï¸âƒ£  SUPPORTING TOOLS:
    â”œâ”€ prepare_training_data.py ................ Triangle wave splitter
    â””â”€ nonlinear_phase_fitter.py ............... Phase model & fitter

4ï¸âƒ£  REFERENCE:
    â””â”€ NONLINEAR_PHASE_GUIDE.md ................ Detailed documentation

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          âš¡ 3-MINUTE SETUP                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Open your_workflow.py

Step 2: Replace the load_data() function with your actual implementation:

    def load_data(filename, arg2, arg3, arg4):
        # YOUR ACTUAL CODE HERE
        data = np.load(filename)
        # ... your processing ...
        return time, mi_signal

Step 3: Run it!

    python your_workflow.py

Step 4: Check outputs:
    â€¢ scan_splitting.png ........... How data was split (visual check)
    â€¢ my_80_samples.png ............ All training samples
    â€¢ my_learned_model.png ......... The nonlinear phase model
    â€¢ my_fit.png ................... Fitting results
    â€¢ my_fitter.pkl ................ Trained model (save this!)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                           ğŸ“Š YOUR WORKFLOW                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    YOUR DATA                         
    t, mi = load_data(...)            
    (triangle wave scan)              
            â”‚                         
            â”œâ”€â–º Split into 80 samples 
            â”‚   (40 forward + 40 back)
            â”‚                         
            â”œâ”€â–º Build phase model     
            â”‚   (learns nonlinearity) 
            â”‚                         
            â””â”€â–º Fit new signals       
                (minimize residuals)  

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          ğŸ’¡ KEY PARAMETERS                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Triangle Wave Splitting:
    cycle_duration = 0.5      # â† Adjust if your round trip â‰  0.5 s

Phase Model:
    model_type = 'polynomial' # Start with this
    degree = 7                # Good balance (try 5-9)

Fitting:
    method = 'optimize'       # Best residual minimization
                              # or 'direct' for faster

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         âœ… EXPECTED RESULTS                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After training:
    âœ“ 80 samples extracted from triangle wave
    âœ“ Nonlinear phase model trained
    âœ“ Training RMSE < 20 rad (typical)

After fitting:
    âœ“ RÂ² > 0.90 (good fit)
    âœ“ RÂ² > 0.95 (excellent fit)
    âœ“ RMSE < 10% of signal range
    âœ“ Residuals randomly distributed

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        ğŸ”§ QUICK TROUBLESHOOTING                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ Wrong number of samples extracted
   â†’ Check cycle_duration parameter
   â†’ Calculate: actual_cycle = total_time / expected_cycles

âŒ Scans look misaligned
   â†’ Data may not start at cycle beginning
   â†’ Manually trim to first peak/trough

âŒ Low RÂ² score on fit
   â†’ Try higher degree (9 instead of 7)
   â†’ Try different model_type ('ml' or 'fourier')
   â†’ Use 'optimize' instead of 'direct'

âŒ Poor fit quality
   â†’ Check if new signal is within training range
   â†’ Add more diverse training samples
   â†’ Increase model complexity

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ğŸ’¾ SAVE & REUSE MODEL                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Train once (slow):
    fitter = NonlinearPhaseFitter()
    fitter.load_training_data(training_samples)
    fitter.build_phase_model('polynomial', degree=7)
    
    # Save it!
    import pickle
    with open('my_fitter.pkl', 'wb') as f:
        pickle.dump(fitter, f)

Use many times (fast):
    with open('my_fitter.pkl', 'rb') as f:
        fitter = pickle.load(f)
    
    # Fit immediately
    fit = fitter.fit_new_signal(time, mi_signal)

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ğŸ“– COMPLETE CODE EXAMPLE                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from prepare_training_data import split_triangle_scans, combine_samples_for_training
from nonlinear_phase_fitter import NonlinearPhaseFitter

# 1. Load
t, mi = load_data("../data/m400_.npy", 2, 0, 50)

# 2. Split
forward, backward = split_triangle_scans(t, mi, cycle_duration=0.5)
training_samples = combine_samples_for_training(forward, backward, use_both=True)

# 3. Train
fitter = NonlinearPhaseFitter()
fitter.load_training_data(training_samples)
fitter.build_phase_model('polynomial', degree=7)

# 4. Fit
fit = fitter.fit_new_signal(time_new, mi_new, method='optimize')

# 5. Results
print(f"RMSE: {fit['rmse']:.6f}")
print(f"RÂ²: {fit['r_squared']:.6f}")
fitted_signal = fit['fitted_signal']
residuals = fit['residuals']

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         ğŸ¯ NEXT STEPS                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Read TRIANGLE_WAVE_GUIDE.md (5 min)
2. Edit your_workflow.py (2 min)
3. Run and review outputs (2 min)
4. If happy, save model and use for all future signals!

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        âœ¨ YOU'RE READY TO GO! âœ¨                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

All tools are tested and working. Your exact use case is fully supported.
Just add your load_data() function and run!

Good luck! ğŸš€
